2.事务
20200926

1.
3阶段
开启：以MULTI开启一个事务
入队：将多个命令入队到事务中，接到这些命令并不会立即执行，而是放到等待执行的事务队列里面
执行：由EXEC命令触发事务

2.
3特性
单独的隔离操作：事务中的所有命令都会序列化，按顺序地执行，事务在执行过程中，不会被其他客户端发送来的命令请求所打断

没有隔离级别的概念：队列中的命令没有提交之前都不会实际的被执行，因为事务提交前任何指令都不会被实际执行，也就不存在“事务内的查询要看到事务里的更新，在事务外查询不能看到”这个让人万分头痛的问题

不保证原子性：redis同一个事务中如果有一条命令执行失败，其他的命令仍然会被执行，没有回滚

3.
https://juejin.im/post/6844903969437777933
事务期间，可能会遇到两种命令错误
(1)
	在调用EXEC命令之前出现错误（COMMAND排队失败）。
		例如，命令可能存在语法错误（参数数量错误，错误的命令名称...）；
		或者可能存在某些关键条件，如内存不足的情况（如果服务器使用maxmemory指令做了内存限制）。

	从Redis 2.6.5开始，服务端会记住在累积命令期间发生的错误，当EXEC命令调用时，将拒绝执行事务，并返回这些错误，同时自动清除命令队列

(2)
	在调用EXEC命令之后出现错误。
		例如，使用错误的值对某个key执行操作（如针对String值调用List操作）

	EXEC命令执行之后发生的错误并不会被特殊对待：即使事务中的某些命令执行失败，其他命令仍会被正常执行


